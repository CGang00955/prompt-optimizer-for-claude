name: CI

on:
  push:
    branches: [ main ]
  pull_request:
    branches: [ main ]

jobs:
  validate:
    runs-on: ubuntu-latest

    steps:
    - name: Checkout code
      uses: actions/checkout@v4

    - name: Setup Node.js
      uses: actions/setup-node@v4
      with:
        node-version: '18.x'

    - name: Check if package.json is valid
      run: |
        node -e "JSON.parse(require('fs').readFileSync('package.json', 'utf8'))"
        echo "✅ package.json is valid JSON"

    - name: Check essential files exist
      run: |
        echo "Checking essential files..."
        test -f "package.json" && echo "✅ package.json exists"
        test -f "README.md" && echo "✅ README.md exists"
        test -f "bin/install.js" && echo "✅ install.js exists"
        test -f "hooks/prompt-optimizer-hook.ts" && echo "✅ prompt-optimizer-hook.ts exists"
        test -f "hooks/metaprompt-enhancer-hook.ts" && echo "✅ metaprompt-enhancer-hook.ts exists"
        test -f "hooks/prompt-optimizer-config.json" && echo "✅ config.json exists"

    - name: Run test script
      run: |
        chmod +x test.js
        node test.js

    - name: Test installation script
      run: |
        node -e "console.log('✅ Installation script is syntactically valid')"